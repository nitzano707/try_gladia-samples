<script>
    const form = document.getElementById('audioForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById('audioFile');
        const file = fileInput.files[0];

        if (!file) {
            alert('Please select an audio file.');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        resultDiv.textContent = 'Uploading and transcribing...';

        try {
            // העלאת הקובץ ושמירת ה-URL
            const uploadResponse = await fetch('https://api.upload.io/upload', {
                method: 'POST',
                headers: {
                    Authorization: `Bearer YOUR_UPLOAD_API_KEY`,
                },
                body: formData,
            });

            const uploadData = await uploadResponse.json();
            const audioUrl = uploadData.fileUrl;

            // קריאה לפונקציית Netlify
            const response = await fetch('/.netlify/functions/transcribe', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ audioFile: audioUrl }),
            });

            const data = await response.json();
            console.log('Response from server:', data);

            if (data.error) {
                resultDiv.textContent = `Error: ${data.error}`;
            } else {
                resultDiv.textContent = `Transcription: ${data.text || 'No transcription text available.'}`;
            }
        } catch (error) {
            console.error('Error during transcription:', error);
            resultDiv.textContent = 'Error during transcription. Check console for details.';
        }
    });
</script>
